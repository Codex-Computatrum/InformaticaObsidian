
![[Pasted image 20231214093701.png]]

#### File system Category
- Solitamente posizionati nel primo settore. 
- Essenziali: info sul layout dei dati. 

- Analisi 
	- info sulla generalizzazione del file system. 
	- info sul layout. 
	- controllo consistenza: Volume slack.


- Content category 
	- Locazioni di memoria impiegate per la memorizzazione del contenuto dei file 
		- Data unit: raggruppamento in più settori
			- stato: allocato e non. 
			- logical file system address. 


- Strategia del primo disponibile 
	- si cerca una data unit libera ogni volta partendo dall' inizio. 
	
- Prossimo disponibile 
	- si cerca partendo dall' ultima locazione allocata. 

- Più adatto 
	- si cercano data unit libere in modo che possano contenere consecutivamente il file. 

Analisi
- Data unit view: settori noti del file system. 
- logical file system searching: ricerca di un contenuto specifico nei data unit. 
- Data unit allocation status: ricerca nei data unit non referenziali in metadata category. 


- Metadata category 
	- descrivono i file presenti in content category 
		- info temporali. 
		- indirizzo delle data unit allocate per i file.
	- Analisi 
		- ricerca di maggiori info su un file. 
		- ricerca di file in base agli attributi descritti in questa categoria. 


- **Logical file address** : 
	- indirizzo di parte del file allocata nella data unit 
		- è il contenuto nella data unit. 

- **Slack space**:
	- parte non usata di una data unit allocata. 

- **File recovery**: 
	- recupero dei file cancellati analizzando le entry in metadata category con lo stato non allocato. 

- **Compressed file**: 
	- memorizzare i dati in un formato compresso occupano meno data unit. 

	- 3 livelli di compressione 
		- soli dati all' interno del file. 
		- di tutto il file. 
		- eseguita nel file system : invisibile nel lato applicativo e utente. 

- **File name category** 
	- nome assegnato a ciascun file (indirizzo della struttura metadato).

	- **File recovery** 
		- recupero dei file cancellati ricercando i file name con lo stato non allocato 
			- analisi della struttura metadati indirizzata. 

- **Application category** 
	- dati non essenziali al file system. 
		- sono più efficienti se conservati nel file system. 
			- spazio occupato, journaling. 

	- **Journaling**: 
		- conservazione delle modifiche effettuate e da effettuare sui metadati 
			- evitare l' inconsistenza 
				- completamento delle operazioni di modifica. 
				- ripristino dei dati a prime delle modifiche (rollback).
		- Analisi
			- ricostruire eventi di un incidente recente.


## FAT file system 
![[Pasted image 20231214102205.png]]


- Analisi 
	- Recuperare info sul layout. 
	
	 - Controllare  possibili dati nascosti 
		 - bootcode. 
		 - settori in reserved areas 
			 - FSINFO.
		- confronto tra boot sector ed il backup del boot sector. 

- **Content category** 
	- contenuto di file e directory. 
	- Cluster: $2^x$ settori (max 32k)
		- primo: indirizzo 2. 
		- solo in data area.


- **FAT**
	- identificare lo stato di allocazione dei cluster. 
	- successivo cluster: cluster chain. 
	- layout: boot sector. 
	- entry di ugual dimensione: FAT12: 12 bit, FAT16, FAT32.
		- entry = cluster.
			- cluster non allocato: zero.
			- cluster allocato 
				- prossimo. 
				- eof.
		- cluster danneggiato.
- Indirizzamento 
	- la prima entry è l' indirizzo 0. 
	- indirizzo entry = indirizzo cluster. 
		- 0 =info dei media. 
		- 1= dirty status. 

- **Metadata category** 
	- info su file e directory 
		- indirizzo del primo cluster. 
	- parent directory 
		- directory entry: 32k
			- file. 
			- directory. 
		- posizionata nella data area (cluster)
		- file name category. 
			- nome file (8 chars) + estensione (3 chars).
			- > long file name directory.

	- info temporali (non essential)
		- data creazione (win).
			- nuovo file/copia => nuova data. 
			- sposto/rinomino => copia data.

		- Data modifica (Win) : modifica del contenuto. 
		- Data accesso (Win): modifica anche visualizzando le proprietà. 
	- Mappare le strutture (metadata) con etichetta 
		- filename. 
	- Directory entry: insieme ai metadata category 
		- filename 11 chars. 
		- long file name  directory entry: +13  chars. 



### NT File system 
![[Pasted image 20231218094733.png]]

- **$MFT** 
	- Ogni file/directory ha almeno una entry (file record). 
	- 1024 byte (boot sector).
	- entry \[0] : $MFT.
	- Starter cluster (boot sector).
- Entry 
	- dim= 1024 byte. 
		- header : 42 byte.
		- attributi: strutture dati. 
	- signature; <\File> / <\Baad>.
	- Stato di allocazione: Attributo $Bitmap nella entry \[0] $MFT.
	- indirizzo sequenziale 48 bit (file number).
	- numero sequenziale: 16 bit (contatore allocazione).

- File system metadata $MFT file 
	- Contiene la master file table. 
		- cluster iniziale : boot sector. 

- Layout 
	- Win 7: cluster 786432. 

- Entry\[0] di MFT
	- $DATA: cluster usati. 
	- $BITMAP: Stato di allocazione delle entry. 

- File system metadata $MFTMirr file 

	- Backup della Master file table.
	- prime 4 entry: $MFT, $MFTMirr, $LogFile, $Volume. 
	- Entry\[1] di MFT.
	- layout 
		- win 7 o superiore: dopo il boot sector (16 settore).
		- prima di win 7: a metà del file System.


- File system metadata $Boot file
	-  Boot sector 
		- Dimensione dei cluster. 
		- nr.settori del file system. 
		- layout MFT
			- cluster iniziale. 
			- dimensione entry. 
		- Entry\[7] di MFT.
	- Layout : primi 16 settori del file system 
		- Signature : 0xAA55.


- File system metadata $Volume File 
	- Info sul volume 
		- etichetta. 
		- versione.
	- Entry \[3] di MFT
		- $Volume_name: nome in unicode del volume 
			- id type: 96.
		- $Volume_information: 
			- versione di ntfs.
			- Dirty status. 
		- $DATA: 0 byte.


- ANALISI:
	- processare il primo settore del file system: Boot sector
		- Layout MFT.
	- Processare la MFT\[0] 
		- $MFTMirr.
	- Processare $volume. 
	- Processare $Attref.
	- processare le altre entry MFT.

- Content category 
	- Contenuto degli attributi 
		- residenti. 
		- non residenti: Cluster esterni. 

	- Cluster 
		- Cluster\[0] = settore\[0] del file system 
			- settore= Cluster x Settori_Cluster.


-  File system metadata $Bitmap File

	- Info sullo stato di allocazione del cluster 
		- Bit\[x] = Cluster\[x].
			- 1= cluster x allocato.
			- 0= non allocato. 
	- entry \[6] MFT.


-  File system metadata $BadClus File
	- Traccia i cluster con settori danneggiati. 

	- Entry\[8] MFT
		- \$Data=\$bad.
			- flag=sparse.
			- size =file system .
			  
![[Pasted image 20231218101853.png]]